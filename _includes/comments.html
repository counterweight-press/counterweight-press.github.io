{% assign slug = page.slug | default: page.title | slugify %}
{% assign comments_path = '_data/comments/' | append: slug %}
{% assign comments = site.data.comments[slug] | sort: 'date' %}

<section class="comments-section">
  <hr class="comments-rule">
  <p class="comments-title">Responses</p>
  
  {% if comments.size > 0 %}
    {% for comment in comments %}
    <div class="comment">
      <div class="comment-meta">
        <span class="comment-author">{{ comment[1].name }}</span>
        <span class="comment-date">{{ comment[1].date | date: "%-d %B %Y" }}</span>
      </div>
      <div class="comment-body">
        <p>{{ comment[1].message | newline_to_br }}</p>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <p class="comments-empty">No responses yet.</p>
  {% endif %}
</section>

<section class="comment-form-section">
  <p class="comment-form-title">Leave a Response</p>
  
  <form 
    class="comment-form"
    method="POST"
    action="https://staticman3.herokuapp.com/v3/entry/github/[GITHUB_USERNAME]/counterweight/main/comments"
  >
    <input type="hidden" name="options[slug]" value="{{ slug }}">
    <input type="hidden" name="options[redirect]" value="{{ page.url | relative_url }}">
    
    <!-- Honeypot -->
    <div style="position: absolute; left: -9999px;">
      <label for="hp-website">Website</label>
      <input type="text" id="hp-website" name="fields[website]" tabindex="-1" autocomplete="off">
    </div>
    
    <div class="form-field">
      <label for="name">Name</label>
      <input 
        type="text" 
        id="name" 
        name="fields[name]" 
        placeholder="How should we address you?" 
        required
      >
    </div>
    
    <div class="form-field">
      <label for="message">Your Response</label>
      <textarea 
        id="message" 
        name="fields[message]" 
        placeholder="What's on your mind?" 
        required
      ></textarea>
    </div>
    
    <button type="submit" class="form-submit">Submit Response</button>
    
    <p class="form-note">
      Responses are moderated and may take time to appear.
    </p>
  </form>
</section>
